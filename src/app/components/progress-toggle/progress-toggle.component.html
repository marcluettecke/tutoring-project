@if (isVisible) {
  <div class="progress-toggle-container">
    <div class="button-wrapper" [title]="(isTrackingEnabled || isPausedForModal || isModalMinimized) ? 'No se puede reiniciar durante el seguimiento' : 'Reiniciar todas las respuestas'">
      <button 
        class="refresh-btn"
        (click)="resetAllAnswers()"
        [disabled]="isTrackingEnabled || isPausedForModal || isModalMinimized"
        aria-label="Reset all answers">
        <fa-icon [icon]="faSync"></fa-icon>
      </button>
    </div>
    
    <div class="button-wrapper" [title]="isModalMinimized ? 'Resume o cierra el modal primero' : tooltipText">
      <button 
        class="progress-toggle-btn"
        [class.recording]="isTrackingEnabled || isPausedForModal"
        [class.paused]="isModalMinimized"
        [disabled]="isModalMinimized"
        (click)="toggleTracking()"
        aria-label="Toggle progress tracking">
        <div class="recording-indicator">
          <div class="recording-dot" [class.paused]="isModalMinimized"></div>
        </div>
        <div class="toggle-icon">
          <fa-icon [icon]="faChartLine"></fa-icon>
        </div>
        <div class="toggle-text">{{ isModalMinimized ? 'Pausado' : (isPausedForModal ? 'Seguimiento ON' : toggleText) }}</div>
      </button>
    </div>
  </div>
}

@if (showSessionSummary && lastSession && currentUserId) {
  <app-result-modal
    [userId]="currentUserId"
    [currentSection]="lastSession.mainSection"
    [currentSubsection]="lastSession.subSection || ''"
    [isProgressTracking]="true"
    [progressSession]="lastSession"
    (onCloseClick)="handleModalClose()"
    (onRetryClick)="handleModalRetry()"
    (onContinueClick)="handleModalContinue()"
    (onMinimizeChange)="handleModalMinimizeChange($event)">
  </app-result-modal>
}